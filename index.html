<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Présentation de la Solution UbiTrack</title>
    <link rel="icon" type="image/png" href="data/icone.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #131E3A;
            --secondary-color: #E21B42;
            --background-color: #f0f2f5;
            --text-color: #333;
            --card-bg-color: #fff;
            --shadow-color: rgba(0,0,0,0.08);
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        .navbar {
            background-color: var(--card-bg-color);
            padding: 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .navbar .logo img {
            height: 40px;
        }
        .nav-links {
            display: flex;
            align-items: center;
        }
        .nav-links a {
            color: var(--primary-color);
            text-decoration: none;
            margin-left: 25px;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        .nav-links a:hover {
            color: var(--secondary-color);
        }
        #lang-select {
            margin-left: 25px;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid var(--primary-color);
            background-color: transparent;
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
        }
        #export-pdf-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 25px;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        #export-pdf-btn:hover {
            background-color: #c01030;
            transform: translateY(-2px);
        }
        .header {
            background: var(--primary-color);
            color: white;
            padding: 50px 20px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 700;
        }
        .header p {
            font-size: 1.2em;
            margin-top: 10px;
            opacity: 0.9;
        }
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        .section {
            background: var(--card-bg-color);
            padding: 40px;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px var(--shadow-color);
        }
        .section h2 {
            color: var(--secondary-color);
            font-size: 2.2em;
            margin-top: 0;
            margin-bottom: 25px;
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 10px;
            display: inline-block;
        }
        .section-intro {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 30px;
        }
        .content-block {
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin-top: 30px;
        }
        .content-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 30px;
        }
        .content-item:nth-child(even) {
            flex-direction: row-reverse;
        }
        .content-text {
            flex: 1;
        }
        .content-text h3 {
            color: var(--primary-color);
            font-size: 1.6em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .content-text h3 i {
            color: var(--secondary-color);
        }
        .content-images {
            flex: 1;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        .content-images img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .mobile-img {
             max-width: 70px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        .form-block {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }
        .form-block h3 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.4em;
            border: none;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #logo-preview {
            max-height: 80px;
            margin-top: 10px;
            border: 1px solid #ddd;
            padding: 5px;
            border-radius: 4px;
            background: white;
        }
        .footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 50px;
            background-color: var(--primary-color);
            color: white;
            border-top: 5px solid var(--secondary-color);
        }
        @media print {
            @page {
                size: A4 portrait;
                margin: 1.5cm;
            }
            body {
                background-color: #fff;
            }
            .navbar, .header, #export-pdf-btn, #lang-select, #customization, .footer {
                display: none !important;
            }
            .container, .section {
                box-shadow: none;
                border: none;
                margin: 0;
                padding: 0;
                margin-bottom: 20px;
            }
            .section {
                page-break-before: always;
            }
            .section:first-of-type {
                page-break-before: auto;
            }
            .cover-page {
                display: flex !important;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                text-align: center;
                height: 100vh;
                page-break-after: always;
            }
            .cover-page .ubi-logo-cover {
                max-width: 250px;
                margin-bottom: 30px;
            }
            .cover-page .client-logo-cover {
                max-width: 200px;
                max-height: 80px;
                margin-top: 20px;
            }
            .cover-page h1 { font-size: 2.5em; }
            .cover-page p { font-size: 1.2em; }
            .content-item {
                 page-break-inside: avoid;
            }
            .contacts-page {
                display: flex !important;
                flex-direction: column;
                padding-top: 1.5cm;
                page-break-before: always;
            }
            .contacts-container { display: flex; gap: 20px; }
            .contact-block { flex: 1; }
        }
        .cover-page, .contacts-page {
            display: none;
        }

    </style>
</head>
<body>

    <div class="cover-page">
        <img src="data/UbiSolutions.png" class="ubi-logo-cover" alt="UBI Solutions Logo">
        <h1 data-lang-key="pdf_title"></h1>
        <p data-lang-key="pdf_author"></p>
        <img id="clientLogoCover" src="" class="client-logo-cover" alt="Client Logo" style="display:none;">
        <p id="clientNameCover"></p>
    </div>
    <div class="contacts-page">
        <h2 data-lang-key="pdf_contacts_title"></h2>
        <div class="contacts-container">
            <div class="contact-block">
                <h3 data-lang-key="pdf_commercial_contact_title"></h3>
                <p id="pdfCommercialName"></p>
                <p id="pdfCommercialEmail"></p>
                <p id="pdfCommercialPhone"></p>
            </div>
            <div class="contact-block">
                <h3 data-lang-key="pdf_technical_contact_title"></h3>
                <p id="pdfTechnicalName"></p>
                <p id="pdfTechnicalEmail"></p>
                <p id="pdfTechnicalPhone"></p>
            </div>
        </div>
    </div>


    <nav class="navbar">
        <div class="logo">
            <a href="#"><img src="data/UbiSolutions.png" alt="UBI Solutions Logo"></a>
        </div>
        <div class="nav-links">
            <a href="#webapp" data-lang-key="nav_webapp"></a>
            <a href="#mobileapp" data-lang-key="nav_mobileapp"></a>
            <a href="#customization" data-lang-key="nav_customization"></a>
            <select id="lang-select">
                <option value="fr">Français</option>
                <option value="en">English</option>
                <option value="es">Español</option>
            </select>
            <button id="export-pdf-btn" data-lang-key="nav_export_pdf"></button>
        </div>
    </nav>

    <header class="header">
        <h1 data-lang-key="header_title"></h1>
        <p data-lang-key="header_subtitle"></p>
    </header>

    <div class="container">

        <div class="section" id="webapp">
            <h2 data-lang-key="webapp_title"></h2>
            <p class="section-intro" data-lang-key="webapp_intro"></p>
            
            <div class="content-block">
                <div class="content-item">
                    <div class="content-text">
                        <h3 data-lang-key="webapp_auth_title"><i class="fas fa-lock"></i> </h3>
                        <p data-lang-key="webapp_auth_desc"></p>
                    </div>
                    <div class="content-images">
                         <img src="data/UbiTrack_Login.jpg" alt="Login Screen">
                    </div>
                </div>
                <div class="content-item">
                    <div class="content-text">
                        <h3 data-lang-key="webapp_config_title"><i class="fas fa-cogs"></i> </h3>
                        <p data-lang-key="webapp_config_desc"></p>
                    </div>
                    <div class="content-images">
                         <img src="data/04-UBITrack_TypesItems.png" alt="Item Types Management">
                         <img src="data/05-UBITrack_Localisations.png" alt="Locations Management">
                    </div>
                </div>
                 <div class="content-item">
                    <div class="content-text">
                        <h3 data-lang-key="webapp_data_vis_title"><i class="fas fa-chart-bar"></i> </h3>
                        <p data-lang-key="webapp_data_vis_desc"></p>
                    </div>
                    <div class="content-images">
                         <img src="data/06-UBITrack_ItemsView.png" alt="Items View">
                         <img src="data/08-UBITrack_StockView.png" alt="Stock View">
                    </div>
                </div>
            </div>
        </div>

        <div class="section" id="mobileapp">
            <h2 data-lang-key="mobileapp_title"></h2>
            <p class="section-intro" data-lang-key="mobileapp_intro"></p>
            
             <div class="content-block">
                <div class="content-item">
                    <div class="content-text">
                        <h3 data-lang-key="mobileapp_access_title"><i class="fas fa-user-shield"></i> </h3>
                        <p data-lang-key="mobileapp_access_desc"></p>
                    </div>
                    <div class="content-images">
                         <img src="data/21-UBITrack_AppLogin.png" class="mobile-img" alt="Mobile Login">
                         <img src="data/11-UBITrack_AppMenu.png" class="mobile-img" alt="Mobile Menu">
                    </div>
                </div>
                <div class="content-item">
                    <div class="content-text">
                        <h3 data-lang-key="mobileapp_features_title"><i class="fas fa-tasks"></i> </h3>
                        <p data-lang-key="mobileapp_features_desc"></p>
                    </div>
                    <div class="content-images">
                         <img src="data/14-UBITrack_AppAsso.png" class="mobile-img" alt="Item Association">
                         <img src="data/18-UBITrack_AppInventory.png" class="mobile-img" alt="Inventory">
                    </div>
                </div>
                 <div class="content-item">
                    <div class="content-text">
                        <h3 data-lang-key="mobileapp_geiger_title"><i class="fas fa-search-location"></i> </h3>
                        <p data-lang-key="mobileapp_geiger_desc"></p>
                    </div>
                    <div class="content-images">
                         <img src="data/15-UBITrack_AppRechercheRed.png" class="mobile-img" alt="Search Far">
                         <img src="data/17-UBITrack_AppRechercheGreen.png" class="mobile-img" alt="Search Close">
                    </div>
                </div>
                 <div class="content-item">
                    <div class="content-text">
                        <h3 data-lang-key="mobileapp_admin_title"><i class="fas fa-sliders-h"></i> </h3>
                        <p data-lang-key="mobileapp_admin_desc"></p>
                    </div>
                    <div class="content-images">
                         <img src="data/24-UBITrack_AppConfig.png" class="mobile-img" alt="Configuration">
                         <img src="data/25-UBITrack_AppMaj.png" class="mobile-img" alt="Application Update">
                    </div>
                </div>
            </div>
        </div>

        <div class="section" id="customization">
            <h2 data-lang-key="customization_title"></h2>
            <div class="form-grid">
                <div class="form-block">
                    <h3 data-lang-key="customization_client_title"></h3>
                    <div class="form-group">
                        <label for="clientName" data-lang-key="customization_client_name"></label>
                        <input type="text" id="clientName">
                    </div>
                    <div class="form-group">
                        <label for="clientLogo" data-lang-key="customization_client_logo"></label>
                        <input type="file" id="clientLogo" accept="image/png, image/jpeg">
                        <img id="logo-preview" src="" alt="Aperçu du logo" style="display: none;">
                    </div>
                </div>
                <div class="form-block">
                    <h3 data-lang-key="customization_commercial_title"></h3>
                    <div class="form-group">
                        <label for="commercialContactSelect" data-lang-key="customization_contact_name"></label>
                        <select id="commercialContactSelect"></select>
                    </div>
                </div>
                <div class="form-block">
                    <h3 data-lang-key="customization_technical_title"></h3>
                    <div class="form-group">
                        <label for="technicalContactSelect" data-lang-key="customization_contact_name"></label>
                        <select id="technicalContactSelect"></select>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <footer class="footer">
        <p data-lang-key="footer_text"></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {

            let contactsData = {};

            try {
                const response = await fetch('data/UBI-Contacts.json');
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                contactsData = await response.json();
            } catch (error) {
                console.error("Impossible de charger le fichier de contacts:", error);
                alert("Attention : Le fichier de contacts (data/UBI-Contacts.json) est introuvable ou invalide. Les listes de contacts seront vides.");
                contactsData = { contacts: { commercial: [], technique: [] } }; // Fallback
            }

            const translations = {
                fr: {
                    pageTitle: "Présentation de la Solution UbiTrack",
                    nav_webapp: "Application Web",
                    nav_mobileapp: "Application Mobile",
                    nav_customization: "Personnalisation",
                    nav_export_pdf: "Exporter en PDF",
                    header_title: "Solution de Traçabilité RFID : UbiTrack",
                    header_subtitle: "Propulsée par UBI Solutions - Optimisez Votre Traçabilité en Temps Réel",
                    webapp_title: "Application Web UbiTrack",
                    webapp_intro: "L'application web UbiTrack est l'interface centrale de gestion et de supervision des données de traçabilité. Elle permet de configurer le système, de gérer les référentiels et de visualiser l'ensemble des données métier collectées en temps réel.",
                    webapp_auth_title: "Authentification Sécurisée",
                    webapp_auth_desc: "Accès sécurisé par login/mot de passe avec intégration possible aux annuaires d'entreprise (LDAP, Azure AD).",
                    webapp_config_title: "Gestion et Configuration",
                    webapp_config_desc: "Paramétrez facilement les types d'articles, les localisations et tous les référentiels métiers depuis une interface claire.",
                    webapp_data_vis_title: "Visualisation des Données",
                    webapp_data_vis_desc: "Consultez le statut des articles, leur historique complet et l'état des stocks en temps réel grâce à des vues dotées de filtres avancés.",
                    mobileapp_title: "Application Mobile",
                    mobileapp_intro: "L'outil de terrain conçu pour les opérateurs. Simple, rapide et efficace pour toutes les opérations quotidiennes.",
                    mobileapp_access_title: "Accès et Droits",
                    mobileapp_access_desc: "Connexion sécurisée par utilisateur avec des menus et fonctionnalités qui s'adaptent aux droits de chacun.",
                    mobileapp_features_title: "Fonctionnalités Métiers",
                    mobileapp_features_desc: "Réalisez l'association article/tag, les inventaires, les entrées et les sorties de stock directement depuis le terminal.",
                    mobileapp_geiger_title: "Recherche (Compteur Geiger)",
                    mobileapp_geiger_desc: "Localisez facilement un article perdu grâce à un indicateur de proximité visuel et sonore.",
                    mobileapp_admin_title: "Administration et Configuration",
                    mobileapp_admin_desc: "Mise à jour simplifiée, configuration de la puissance RFID et verrouillage du terminal sur l'application (StageNow).",
                    customization_title: "Personnalisation du Rapport",
                    customization_client_title: "Informations Client",
                    customization_client_name: "Nom du Client",
                    customization_client_logo: "Logo du Client (PNG, JPG)",
                    customization_commercial_title: "Contact Commercial",
                    customization_technical_title: "Contact Technique",
                    customization_contact_name: "Sélectionner un contact",
                    footer_text: "© 2025 UBI Solutions. Tous droits réservés.",
                    pdf_title: "Présentation UbiTrack",
                    pdf_author: "Auteur : CGZ",
                    pdf_contacts_title: "Contacts",
                    pdf_commercial_contact_title: "Contact Commercial",
                    pdf_technical_contact_title: "Contact Technique",
                    select_option_default: "-- Sélectionner --"
                },
                en: {
                    pageTitle: "UbiTrack Solution Presentation",
                    nav_webapp: "Web Application",
                    nav_mobileapp: "Mobile Application",
                    nav_customization: "Customization",
                    nav_export_pdf: "Export to PDF",
                    header_title: "RFID Tracking Solution: UbiTrack",
                    header_subtitle: "Powered by UBI Solutions - Optimize Your Real-Time Tracking",
                    webapp_title: "UbiTrack Web Application",
                    webapp_intro: "The UbiTrack web application is the central interface for the management and supervision of traceability data. It allows for system configuration, repository management, and real-time visualization of all collected business data.",
                    webapp_auth_title: "Secure Authentication",
                    webapp_auth_desc: "Secure access via login/password with possible integration with corporate directories (LDAP, Azure AD).",
                    webapp_config_title: "Management and Configuration",
                    webapp_config_desc: "Easily configure item types, locations, and all business repositories from a clear interface.",
                    webapp_data_vis_title: "Data Visualization",
                    webapp_data_vis_desc: "View the status of items, their complete history, and stock levels in real-time through views equipped with advanced filters.",
                    mobileapp_title: "Mobile Application",
                    mobileapp_intro: "The field tool designed for operators. Simple, fast, and efficient for all daily operations.",
                    mobileapp_access_title: "Access and Permissions",
                    mobileapp_access_desc: "Secure user login with menus and features that adapt to each user's permissions.",
                    mobileapp_features_title: "Business Features",
                    mobileapp_features_desc: "Perform item/tag association, inventories, and stock movements directly from the terminal.",
                    mobileapp_geiger_title: "Search (Geiger Counter)",
                    mobileapp_geiger_desc: "Easily locate a lost item with a visual and audible proximity indicator.",
                    mobileapp_admin_title: "Administration and Configuration",
                    mobileapp_admin_desc: "Simplified updates, RFID power configuration, and kiosk mode to lock the terminal to the application (StageNow).",
                    customization_title: "Report Customization",
                    customization_client_title: "Client Information",
                    customization_client_name: "Client Name",
                    customization_client_logo: "Client Logo (PNG, JPG)",
                    customization_commercial_title: "Commercial Contact",
                    customization_technical_title: "Technical Contact",
                    customization_contact_name: "Select a contact",
                    footer_text: "© 2025 UBI Solutions. All rights reserved.",
                    pdf_title: "UbiTrack Presentation",
                    pdf_author: "Author: CGZ",
                    pdf_contacts_title: "Contacts",
                    pdf_commercial_contact_title: "Commercial Contact",
                    pdf_technical_contact_title: "Technical Contact",
                    select_option_default: "-- Select --"
                },
                es: {
                    pageTitle: "Presentación de la Solución UbiTrack",
                    nav_webapp: "Aplicación Web",
                    nav_mobileapp: "Aplicación Móvil",
                    nav_customization: "Personalización",
                    nav_export_pdf: "Exportar a PDF",
                    header_title: "Solución de Trazabilidad RFID: UbiTrack",
                    header_subtitle: "Impulsado por UBI Solutions - Optimice Su Trazabilidad en Tiempo Real",
                    webapp_title: "Aplicación Web UbiTrack",
                    webapp_intro: "La aplicación web UbiTrack es la interfaz central de gestión y supervisión de los datos de trazabilidad. Permite configurar el sistema, gestionar los repositorios y visualizar el conjunto de los datos de negocio recopilados en tiempo real.",
                    webapp_auth_title: "Autenticación Segura",
                    webapp_auth_desc: "Acceso seguro mediante usuario/contraseña con posible integración en directorios corporativos (LDAP, Azure AD).",
                    webapp_config_title: "Gestión y Configuración",
                    webapp_config_desc: "Configure fácilmente los tipos de artículos, las ubicaciones y todos los repositorios de negocio desde una interfaz clara.",
                    webapp_data_vis_title: "Visualización de Datos",
                    webapp_data_vis_desc: "Consulte el estado de los artículos, su historial completo y los niveles de stock en tiempo real a través de vistas con filtros avanzados.",
                    mobileapp_title: "Aplicación Móvil",
                    mobileapp_intro: "La herramienta de campo diseñada para los operadores. Sencilla, rápida y eficaz para todas las operaciones diarias.",
                    mobileapp_access_title: "Acceso y Permisos",
                    mobileapp_access_desc: "Inicio de sesión de usuario seguro con menús y funcionalidades que se adaptan a los permisos de cada uno.",
                    mobileapp_features_title: "Funcionalidades de Negocio",
                    mobileapp_features_desc: "Realice la asociación de artículo/etiqueta, inventarios y movimientos de stock directamente desde el terminal.",
                    mobileapp_geiger_title: "Búsqueda (Contador Geiger)",
                    mobileapp_geiger_desc: "Localice fácilmente un artículo perdido con un indicador de proximidad visual y sonoro.",
                    mobileapp_admin_title: "Administración y Configuración",
                    mobileapp_admin_desc: "Actualizaciones simplificadas, configuración de la potencia RFID y modo quiosco para bloquear el terminal en la aplicación (StageNow).",
                    customization_title: "Personalización del Informe",
                    customization_client_title: "Información del Cliente",
                    customization_client_name: "Nombre del Cliente",
                    customization_client_logo: "Logo del Cliente (PNG, JPG)",
                    customization_commercial_title: "Contacto Comercial",
                    customization_technical_title: "Contacto Técnico",
                    customization_contact_name: "Seleccionar un contacto",
                    footer_text: "© 2025 UBI Solutions. Todos los derechos reservados.",
                    pdf_title: "Presentación UbiTrack",
                    pdf_author: "Autor: CGZ",
                    pdf_contacts_title: "Contactos",
                    pdf_commercial_contact_title: "Contacto Comercial",
                    pdf_technical_contact_title: "Contacto Técnico",
                    select_option_default: "-- Seleccionar --"
                }
            };

            const langSelector = document.getElementById('lang-select');
            const exportPdfBtn = document.getElementById('export-pdf-btn');

            function applyLanguage(lang) {
                document.documentElement.lang = lang;
                langSelector.value = lang;
                document.querySelectorAll('[data-lang-key]').forEach(el => {
                    const key = el.getAttribute('data-lang-key');
                    if(translations[lang][key]) {
                        el.innerHTML = translations[lang][key];
                    }
                });
                document.title = translations[lang].pageTitle;
                populateContactDropdown('commercialContactSelect', 'commercial', lang);
                populateContactDropdown('technicalContactSelect', 'technical', lang);
            }
            
            function preparePdfCustomElements() {
                const lang = localStorage.getItem('selectedLanguage') || 'fr';
                document.querySelector('.cover-page h1').textContent = translations[lang].pdf_title;
                document.querySelector('.cover-page p').textContent = translations[lang].pdf_author;
                const clientName = localStorage.getItem('clientName') || '';
                document.getElementById('clientNameCover').textContent = clientName;
                const clientLogo = localStorage.getItem('clientLogoB64');
                const clientLogoCoverEl = document.getElementById('clientLogoCover');
                if (clientLogo && clientName) {
                    clientLogoCoverEl.src = clientLogo;
                    clientLogoCoverEl.style.display = 'block';
                } else {
                    clientLogoCoverEl.style.display = 'none';
                }
                document.querySelector('.contacts-page h2').textContent = translations[lang].pdf_contacts_title;
                document.querySelector('.contacts-page .contact-block:nth-child(1) h3').textContent = translations[lang].pdf_commercial_contact_title;
                document.querySelector('.contacts-page .contact-block:nth-child(2) h3').textContent = translations[lang].pdf_technical_contact_title;
                
                document.getElementById('pdfCommercialName').textContent = `Nom: ${localStorage.getItem('commercialName') || ''}`;
                document.getElementById('pdfCommercialEmail').textContent = `Email: ${localStorage.getItem('commercialEmail') || ''}`;
                document.getElementById('pdfCommercialPhone').textContent = `Tél: ${localStorage.getItem('commercialPhone') || ''}`;
                document.getElementById('pdfTechnicalName').textContent = `Nom: ${localStorage.getItem('technicalName') || ''}`;
                document.getElementById('pdfTechnicalEmail').textContent = `Email: ${localStorage.getItem('technicalEmail') || ''}`;
                document.getElementById('pdfTechnicalPhone').textContent = `Tél: ${localStorage.getItem('technicalPhone') || ''}`;
            }

            function populateContactDropdown(selectId, type, lang) {
                const select = document.getElementById(selectId);
                const savedName = localStorage.getItem(`${type}Name`);
                select.innerHTML = ''; 

                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = translations[lang].select_option_default;
                select.appendChild(defaultOption);

                if (contactsData.contacts && contactsData.contacts[type]) {
                    contactsData.contacts[type].forEach(contact => {
                        const option = document.createElement('option');
                        option.value = contact.nom;
                        option.textContent = contact.nom;
                        select.appendChild(option);
                    });
                }

                if (savedName) {
                    select.value = savedName;
                }
            }

            // --- Initialisation ---
            const savedLang = localStorage.getItem('selectedLanguage') || 'fr';
            applyLanguage(savedLang);

            langSelector.addEventListener('change', (e) => {
                applyLanguage(e.target.value);
                localStorage.setItem('selectedLanguage', e.target.value);
            });

            exportPdfBtn.addEventListener('click', () => {
                preparePdfCustomElements();
                window.print();
            });

            // --- Logique de Personnalisation ---
            const clientNameInput = document.getElementById('clientName');
            clientNameInput.value = localStorage.getItem('clientName') || '';
            clientNameInput.addEventListener('input', () => {
                localStorage.setItem('clientName', clientNameInput.value);
            });

            const clientLogoInput = document.getElementById('clientLogo');
            const logoPreview = document.getElementById('logo-preview');
            const savedLogo = localStorage.getItem('clientLogoB64');
            if (savedLogo) {
                logoPreview.src = savedLogo;
                logoPreview.style.display = 'block';
            }
            clientLogoInput.addEventListener('change', () => {
                const file = clientLogoInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        logoPreview.src = e.target.result;
                        logoPreview.style.display = 'block';
                        localStorage.setItem('clientLogoB64', e.target.result);
                    };
                    reader.readAsDataURL(file);
                } else {
                     logoPreview.style.display = 'none';
                     localStorage.removeItem('clientLogoB64');
                }
            });

            ['commercial', 'technical'].forEach(type => {
                const select = document.getElementById(`${type}ContactSelect`);
                select.addEventListener('change', (e) => {
                    const selectedName = e.target.value;
                    if (contactsData.contacts && contactsData.contacts[type]) {
                        const contactList = contactsData.contacts[type];
                        const selectedContact = contactList.find(c => c.nom === selectedName);

                        if(selectedContact) {
                            localStorage.setItem(`${type}Name`, selectedContact.nom);
                            localStorage.setItem(`${type}Email`, selectedContact.email);
                            localStorage.setItem(`${type}Phone`, selectedContact.téléphone);
                        } else {
                            localStorage.removeItem(`${type}Name`);
                            localStorage.removeItem(`${type}Email`);
                            localStorage.removeItem(`${type}Phone`);
                        }
                    }
                });
            });

        });
    </script>

</body>
</html>

